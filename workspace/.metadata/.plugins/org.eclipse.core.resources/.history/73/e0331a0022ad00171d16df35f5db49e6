package monitor;

import archivos.Escritor;
import archivos.Lector;
import archivos.Matriz;

import java.util.Arrays;
import java.util.HashMap;

public class RdP {
	
	private int TRANS;
	private int PLAZAS;
	private Matriz Marcado;
	private Matriz MatrizI;
	private HashMap<String, Matriz> hash;
	
	public RdP() {
		
		Lector lector = new Lector();
		hash = lector.leerHTML();
		
		Marcado = hash.get("marcado");
		MatrizI = hash.get("incidencia");
		
		PLAZAS = (MatrizI.getFilas());
		TRANS = (MatrizI.getColumnas());
		
		/*Marcado = new int[] {1, 1, 1, 1, 6, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1};
		MatrizI = new int[][] { {0, -1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, -1, 0, 1, 0, 0, 0, -1, 1, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, -1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 1, 0},
								{0, 0, 0, 0, 0, 0, -1, 0, 1, 0, 0, 0, 0, 0, 0, -1, 1, 0, 0, 0},
								{-1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
								{1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 1, 1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 1, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, -1, 0, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, -1, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, -1, 0, 0, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 1},
								{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, -1, 0, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, -1, 0, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, -1, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, -1, 0},
								{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, -1},
								{-1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 1},
								{0, 0, 0, -1, -1, 1, 1, 0, 0, 0, -1, 1, -1, 1, 0, 0, -1, 1, 0, 0},
								{0, 0, 0, 0, 0, 0, 0, -1, -1, 1, 0, 0, 0, 0, -1, 1, 0, 0, 0, 0},
								{0, 0, 0, -1, 0, 1, 0, 0, 0, 0, 0, -1, 1, 0, 0, 0, 0, 0, 0, 0},
								{0, 0, -1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 1, 0} };
				*/				
	}
	
	public Matriz getSencib() {
		int f;
		Matriz sencib = new Matriz(1, TRANS);
		
		for (int i = 0 ; i < TRANS ; i++) {
			f = 0;
			for (int j = 0 ; j < PLAZAS ; j++) {
				if (Marcado.getValor(1, j) + MatrizI.getValor(j, i) > 0) { sencib.setValor(1, i, 1); }
				else if (Marcado.getValor(1, j) + MatrizI.getValor(j, i) < 0) { f++; }
			}
			if (f > 0) { sencib.setValor(1, i, 0); }
		}
		return sencib;		
	}
	
	public boolean isSencib(int t) {
		int[] v = getSencib();
		
		if (v[t] == 1) { return true; }
		else { return false; }
	}
	
	public void newState(int t) {
		for (int i = 0 ; i < PLAZAS ; i++) {
			Marcado[i] = Marcado[i] + MatrizI[i][t];
		}
	}
	
	public boolean shoot(int t) {
		if (isSencib(t)) { newState(t); guardarMarcado(); return true; }
		else { return false; }
	}
	
	public void guardarMarcado () {
		Escritor.getInstance().guardar(Arrays.toString(Marcado));
	}
}
